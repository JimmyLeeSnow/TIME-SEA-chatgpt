(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/drawing/sdImage2imageView"],{"1e25":function(e,t,n){"use strict";n.r(t);var i=n("7632"),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=a.a},6003:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){}));var i=function(){var e=this.$createElement;this._self._c},a=[]},"68e7":function(e,t,n){},7632:function(e,t,n){"use strict";(function(e,i){var a=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("2eee")),r=a(n("c973")),s=n("8b57"),c=a(n("9e95")),u=n("024e"),d={components:{LoadingComponent:function(){n.e("wxcomponents/components/loadingComponent").then(function(){return resolve(n("10e5"))}.bind(null,n)).catch(n.oe)},GenerateLoadingComponent:function(){n.e("pages/drawing/components/generateLoadingComponent").then(function(){return resolve(n("8058"))}.bind(null,n)).catch(n.oe)}},data:function(){return{form:{images:"",prompt:"",width:512,height:512,seed:0,restore_faces:0,modelName:"",location:0,negative_prompt:""},msg:"正在检查绘图服务运行状态",size:[{width:512,height:512,isSelected:!0,text:"标准分辨率"},{width:1024,height:1024,isSelected:!1,text:"高分辨率"}],random:[{seed:0,isSelected:!1,text:"不随机"},{seed:50,isSelected:!1,text:"随机"},{seed:123,isSelected:!0,text:"任意"}],model:[]}},created:function(){var e=this;this.model=c.default.sdModels,this.model.forEach((function(t){t.isSelected&&(e.form.modelName=t.modelName)}))},methods:{handleModel:function(e){this.model.forEach((function(e){return e.isSelected=!1})),this.model[e].isSelected=!0,this.form.modelName=this.model[e].modelName},beforeRead:function(t){var n=t.detail,i=n.file,a=n.callback;try{i.size>2097152?e.showToast({title:"图片超过了2MB,请重新选择",icon:"none",duration:4e3}):a(!0)}catch(t){this.form.images=void 0}},previousPage:function(){e.navigateBack()},examineServer:function(){var t=(0,r.default)(o.default.mark((function t(){var n,i;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this.$refs.loadingRef,t.prev=1,n.openShow(),t.next=5,(0,s.sdConnectivity)(1);case 5:if(i=t.sent,i){t.next=10;break}return this.msg="请联系小程序管理员开启绘图服务",setTimeout((function(){e.navigateBack()}),3e3),t.abrupt("return");case 10:n.closeShow(),t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](1),this.msg=t.t0,setTimeout((function(){e.navigateBack()}),3e3);case 17:case"end":return t.stop()}}),t,this,[[1,13]])})));return function(){return t.apply(this,arguments)}}(),isDrawingSucceed:function(){var t=(0,r.default)(o.default.mark((function t(n){var i,a,r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=this,a=this.$refs.generateLoadingRef,t.prev=2,t.next=5,(0,s.isDrawingSucceed)(n);case 5:r=t.sent,r&&(a.closeShow(),i.stopTimer(),e.navigateTo({url:"/pages/drawing/drawingResultView?drawingId="+n})),t.next=14;break;case 9:t.prev=9,t.t0=t["catch"](2),e.showToast({title:"数据异常",icon:"none",duration:2e3}),this.stopTimer(),setTimeout((function(){e.navigateBack()}),3e3);case 14:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(e){return t.apply(this,arguments)}}(),stopTimer:function(){clearInterval(this.timer)},deleted:function(){this.form.images=""},submit:function(){var t=(0,r.default)(o.default.mark((function t(){var n,a,s,d,f,l;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=this.form,a=n.images,s=n.prompt,a){t.next=4;break}return e.showToast({title:"请上传参考图",icon:"none",duration:4e3}),t.abrupt("return");case 4:if(s){t.next=7;break}return e.showToast({title:"请填写描述",icon:"none",duration:4e3}),t.abrupt("return");case 7:d=this,f=c.default.tmplIds,l=c.default.baseUrl,e.requestSubscribeMessage({tmplIds:f,success:function(){var t=(0,r.default)(o.default.mark((function t(n){var a,s;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=l+"/drawing/sd/image2image","accept"===n[f[0]]&&(s=d.$refs.generateLoadingRef,e.showLoading({title:"正在加入队列~",mask:!0}),i.uploadFile({url:a,filePath:d.form.images,name:"images",header:{token:(0,u.getToken)()},formData:{width:d.form.width,prompt:d.form.prompt,height:d.form.height,seed:d.form.seed,restore_faces:d.form.restore_faces,modelName:d.form.modelName,negative_prompt:d.form.negative_prompt},success:function(t){var n=this;return(0,r.default)(o.default.mark((function i(){var a,r;return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:a=JSON.parse(t.data),200==a.code?(r=a.data,n.location=r.location,e.showToast({title:"操作成功",icon:"none",duration:2e3}),s.openShow(),d.timer=setInterval((function(){d.isDrawingSucceed(r.drawingId)}),5e3)):(d.stopTimer(),console.log(t),e.showToast({title:"操作繁忙 请稍后再试",icon:"none",duration:2e3}),setTimeout((function(){e.navigateBack()}),1e3),e.hideLoading());case 2:case"end":return i.stop()}}),i)})))()},fail:function(t){e.showToast({title:"服务貌似被关闭了",icon:"none",duration:1e3}),e.hideLoading(),setTimeout((function(){e.navigateBack()}),2e3)}}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()});case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),handleRandom:function(e){this.random.forEach((function(e){return e.isSelected=!1})),this.random[e].isSelected=!0,this.form.seed=this.random[e].seed},handleSize:function(e){this.size.forEach((function(e){return e.isSelected=!1})),this.size[e].isSelected=!0,this.form.height=this.size[e].height,this.form.width=this.size[e].width},imageCacheCallback:function(e){var t=e.detail.file;this.form.images=t.url},previewImage:function(t){e.previewImage({urls:[t]})}},beforeDestroy:function(){clearInterval(this.timer)},onLoad:function(){this.examineServer()},onUnload:function(){e.$emit("master_userInfo")}};t.default=d}).call(this,n("543d")["default"],n("bc2e")["default"])},a1ec:function(e,t,n){"use strict";var i=n("68e7"),a=n.n(i);a.a},a903:function(e,t,n){"use strict";(function(e,t){var i=n("4ea4");n("4943");i(n("66fd"));var a=i(n("ff0a"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},ff0a:function(e,t,n){"use strict";n.r(t);var i=n("6003"),a=n("1e25");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("a1ec");var r=n("f0c5"),s=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=s.exports}},[["a903","common/runtime","common/vendor"]]]);