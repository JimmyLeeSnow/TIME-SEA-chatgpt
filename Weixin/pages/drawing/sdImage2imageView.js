(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/drawing/sdImage2imageView"],{"1f28":function(e,t,n){"use strict";(function(e,a){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("2eee")),r=i(n("c973")),s=n("a6cf"),c=i(n("0ad6")),u=n("68f3"),f={components:{LoadingComponent:function(){n.e("wxcomponents/components/loadingComponent").then(function(){return resolve(n("7e70"))}.bind(null,n)).catch(n.oe)},GenerateLoadingComponent:function(){n.e("pages/drawing/components/generateLoadingComponent").then(function(){return resolve(n("98fd"))}.bind(null,n)).catch(n.oe)}},data:function(){return{form:{images:"",prompt:"",width:512,height:512,seed:0,restore_faces:0,modelName:"",location:0,negative_prompt:""},msg:"正在检查绘图服务运行状态",size:[{width:512,height:512,isSelected:!0,text:"标准分辨率"},{width:1024,height:1024,isSelected:!1,text:"高分辨率"}],model:[]}},created:function(){var e=this;this.model=c.default.sdModels,this.model.forEach((function(t){t.isSelected&&(e.form.modelName=t.modelName)}))},methods:{handleModel:function(e){this.model.forEach((function(e){return e.isSelected=!1})),this.model[e].isSelected=!0,this.form.modelName=this.model[e].modelName},beforeRead:function(t){var n=t.detail,a=n.file,i=n.callback;try{a.size>2097152?e.showToast({title:"图片超过了2MB,请重新选择",icon:"none",duration:4e3}):i(!0)}catch(t){this.form.images=void 0}},previousPage:function(){e.navigateBack()},examineServer:function(){var t=(0,r.default)(o.default.mark((function t(){var n,a;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this.$refs.loadingRef,t.prev=1,n.openShow(),t.next=5,(0,s.sdConnectivity)(1);case 5:if(a=t.sent,a){t.next=10;break}return this.msg="请联系小程序管理员开启绘图服务",setTimeout((function(){e.navigateBack()}),3e3),t.abrupt("return");case 10:n.closeShow(),t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](1),this.msg=t.t0,setTimeout((function(){e.navigateBack()}),3e3);case 17:case"end":return t.stop()}}),t,this,[[1,13]])})));return function(){return t.apply(this,arguments)}}(),isDrawingSucceed:function(){var t=(0,r.default)(o.default.mark((function t(n){var a,i,r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=this,i=this.$refs.generateLoadingRef,t.prev=2,t.next=5,(0,s.isDrawingSucceed)(n);case 5:r=t.sent,r&&(i.closeShow(),a.stopTimer(),e.navigateTo({url:"/pages/drawing/drawingResultView?drawingId="+n})),t.next=14;break;case 9:t.prev=9,t.t0=t["catch"](2),e.showToast({title:t.t0,icon:"none",duration:2e3}),this.stopTimer(),setTimeout((function(){e.navigateBack()}),3e3);case 14:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(e){return t.apply(this,arguments)}}(),stopTimer:function(){clearInterval(this.timer)},deleted:function(){this.form.images=""},submit:function(){var t=(0,r.default)(o.default.mark((function t(){var n,i,s,f,d,l;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=this.form,i=n.images,s=n.prompt,i){t.next=4;break}return e.showToast({title:"请上传参考图",icon:"none",duration:4e3}),t.abrupt("return");case 4:if(s){t.next=7;break}return e.showToast({title:"请填写描述",icon:"none",duration:4e3}),t.abrupt("return");case 7:f=this,d=c.default.tmplIds,l=c.default.baseUrl,e.requestSubscribeMessage({tmplIds:d,success:function(){var t=(0,r.default)(o.default.mark((function t(n){var i,s;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=l+"/drawing/sd/image2image","accept"===n[d[0]]&&(s=f.$refs.generateLoadingRef,e.showLoading({title:"正在加入队列~",mask:!0}),a.uploadFile({url:i,filePath:f.form.images,name:"images",header:{token:(0,u.getToken)()},formData:{width:f.form.width,prompt:f.form.prompt,height:f.form.height,seed:f.form.seed,restore_faces:f.form.restore_faces,modelName:f.form.modelName,negative_prompt:f.form.negative_prompt},success:function(t){var n=this;return(0,r.default)(o.default.mark((function a(){var i,r;return o.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:i=JSON.parse(t.data),200===i.code?(r=i.data,n.location=r.location,e.showToast({title:"操作成功",icon:"none",duration:2e3}),s.openShow(),f.timer=setInterval((function(){f.isDrawingSucceed(r.drawingId)}),5e3)):(f.stopTimer(),e.showToast({title:i.msg,icon:"none",duration:2e3}),e.hideLoading());case 2:case"end":return a.stop()}}),a)})))()},fail:function(t){console.log(t),console.log("错误"),e.showToast({title:"服务貌似被关闭了",icon:"none",duration:1e3}),e.hideLoading(),setTimeout((function(){e.navigateBack()}),2e3)}}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()});case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),handleSize:function(e){this.size.forEach((function(e){return e.isSelected=!1})),this.size[e].isSelected=!0,this.form.height=this.size[e].height,this.form.width=this.size[e].width},imageCacheCallback:function(e){var t=e.detail.file;this.form.images=t.url},previewImage:function(t){e.previewImage({urls:[t]})}},beforeDestroy:function(){clearInterval(this.timer)},onLoad:function(){this.examineServer()},onUnload:function(){e.$emit("master_userInfo")}};t.default=f}).call(this,n("543d")["default"],n("bc2e")["default"])},"564a":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var a=function(){var e=this.$createElement;this._self._c},i=[]},"6f4e":function(e,t,n){"use strict";n.r(t);var a=n("564a"),i=n("f69a");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n("dfcf");var r=n("f0c5"),s=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);t["default"]=s.exports},"81f3":function(e,t,n){"use strict";(function(e,t){var a=n("4ea4");n("48aa");a(n("66fd"));var i=a(n("6f4e"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},b06e:function(e,t,n){},dfcf:function(e,t,n){"use strict";var a=n("b06e"),i=n.n(a);i.a},f69a:function(e,t,n){"use strict";n.r(t);var a=n("1f28"),i=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a}},[["81f3","common/runtime","common/vendor"]]]);